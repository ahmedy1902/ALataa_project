@using Accounts.ViewModels
@model RegisterModel

@{
    ViewData["Title"] = "Register";
    Layout = "_AddCoursesLayout";
}

<h2>Register</h2>

<form asp-action="Register" method="post">
    <div asp-validation-summary="All" class="text-danger"></div>

    <!-- Email -->
    <div class="form-group">
        <label asp-for="Email"></label>
        <input asp-for="Email" class="form-control" id="Email" />
        <span asp-validation-for="Email" class="text-danger"></span>
    </div>

    <!-- Password -->
    <div class="form-group">
        <label asp-for="Password"></label>
        <input asp-for="Password" class="form-control" type="password" id="Password" />
        <span asp-validation-for="Password" class="text-danger"></span>
    </div>

    <!-- Confirm Password -->
    <div class="form-group">
        <label asp-for="ConfirmPassword"></label>
        <input asp-for="ConfirmPassword" class="form-control" type="password" id="ConfirmPassword" />
        <span asp-validation-for="ConfirmPassword" class="text-danger"></span>
    </div>

    <!-- Role -->
    <div class="form-group">
        <label asp-for="Role">Role</label>
        <select asp-for="Role" class="form-control" id="Role">
            <option value="">-- Select Role --</option>
            <option value="Donor">Donor</option>
            <option value="Charity">Charity</option>
            <option value="Beneficiary">Beneficiary</option>
        </select>
        <span asp-validation-for="Role" class="text-danger"></span>
    </div>

    <!-- Beneficiary fields -->
    <div id="beneficiaryFields" style="display:none;">
        <div class="form-group mt-3">
            <label asp-for="NeededAmount">Needed Amount</label>
            <input asp-for="NeededAmount" class="form-control" type="number" min="1" />
            <span asp-validation-for="NeededAmount" class="text-danger"></span>
        </div>
        <div class="form-group mt-3">
            <label asp-for="HelpFields">Help Field</label>
            <select asp-for="HelpFields" class="form-control" multiple>
                <option value="Food Supplies">Food Supplies</option>
                <option value="Shelter / Housing">Shelter / Housing</option>
                <option value="Medical Assistance / Medicine">Medical Assistance / Medicine</option>
                <option value="Utilities (Water/Electricity)">Utilities (Water/Electricity)</option>
                <option value="Clothing">Clothing</option>
                <option value="Other">Other</option>
            </select>
            <span asp-validation-for="HelpFields" class="text-danger"></span>
        </div>
    </div>

    <!-- Survey iframe -->
    <div id="DonorIframe" style="display: none;" class="mt-3">
        <iframe id="surveyFrame" src="" width="100%" height="400" style="border:1px solid #ccc; border-radius:8px; box-shadow:0 0 10px rgba(0,0,0,0.15);" allowfullscreen loading="lazy"></iframe>
    </div>

    <!-- Loading indicator -->
    <div id="loadingSurvey" style="display:none;" class="text-center mt-2">
        <div class="spinner-border text-primary"></div>
        <p>Loading survey...</p>
    </div>

    <!-- Success message -->
    <div id="successAlert" class="alert alert-success mt-3" style="display:none;">
        ✅ Registration completed successfully!
    </div>

    <!-- Submit -->
    <div class="form-group mt-3">
        <input type="submit" value="Register" class="btn btn-primary" id="submitBtn" />
    </div>
</form>

@section Scripts {
    <partial name="_ValidationScriptsPartial" />
    <script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>

    <script>
        function toggleFields() {
            const role = $("#Role").val();
            const iframe = $("#surveyFrame");
            const iframeContainer = $("#DonorIframe");

            if (role === "Donor") {
                iframe.attr("src", "https://arcg.is/eHWC1");
                iframeContainer.show();
                $("#beneficiaryFields").hide();
                $("#loadingSurvey").show();
            } else if (role === "Charity") {
                iframe.attr("src", "https://survey123.arcgis.com/share/2c36d5ade9064fe685d54893df3b37ea");
                iframeContainer.show();
                $("#beneficiaryFields").hide();
                $("#loadingSurvey").show();
            } else if (role === "Beneficiary") {
                iframeContainer.hide();
                $("#beneficiaryFields").show();
                $("#loadingSurvey").hide();
            } else {
                iframeContainer.hide();
                $("#beneficiaryFields").hide();
                $("#loadingSurvey").hide();
            }
        }

        $(document).ready(function () {
            toggleFields();

            $("#Role").on("change", toggleFields);
        });
    </script>
}